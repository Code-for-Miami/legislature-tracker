/*! legislature-tracker - v0.0.3 - 2013-06-17
* https://github.com/MinnPost/legislature-tracker
* Copyright (c) 2013 ; Licensed MIT */

!function(a){_.mixin({trim:function(a){return _.isString(a)&&(a=String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")),a},cssClass:function(a){return a.replace(/[^a-z0-9]/g,"-")},numberFormatCommas:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},ellipsisText:function(a,b){var c,d,e,f,g="",h="<!-- break -->",i='<ins class="ellipsis-start">[[[TEXT]]]</ins>',j='<ins class="ellipsis-ellipsis">...</ins>',k='<ins class="ellipsis-end">[[[TEXT]]]</ins>';return-1!==a.indexOf(h)?(c=a.indexOf(h),g+=i.replace("[[[TEXT]]]",a.substring(0,c))+" ",g+=j+" ",g+=k.replace("[[[TEXT]]]",a.substring(c,a.length))+" "):(f=a.split(" "),f.length<=b?g+=i.replace("[[[TEXT]]]",a):(d=f.slice(0,b),e=f.slice(b),g+=i.replace("[[[TEXT]]]",d.join(" "))+" ",g+=j+" ",g+=k.replace("[[[TEXT]]]",e.join(" "))+" ")),g},parseURL:function(a){var b=document.createElement("a");return b.href=a,b}}),_.isFunction(Backbone.$.jsonp)&&(Backbone.ajax=function(){return Backbone.$.jsonp.apply(Backbone.$,arguments)}),a.fn.hasScrollBar=function(){return this.get(0)&&this.get(0).scrollHeight?this.get(0).scrollHeight>this.height():!1}}(jQuery,window);var LT,originalLT,exports=exports||void 0;_.isUndefined(exports)?(originalLT=window.LT,LT={},LT.noConflict=function(){return window.LT=originalLT,this},window.LT=LT):LT=exports,function(a,b,c){LT.cache={},LT.cache.models={},LT.log=function(a){_.isUndefined(window.console)||window.console.log(a)},LT.utils={},LT.utils.getModel=function(a,b,c,d){var e=a+":"+b+":"+c[b];return d=d||LT.options,_.isUndefined(LT.cache.models[e])&&(LT.cache.models[e]=new LT[a](c,d)),LT.cache.models[e]},LT.utils.fetchModel=function(b){var c;return b.get("fetched")!==!0?b.fetch():(c=a.Deferred(),c.resolveWith(b),c)},LT.utils.translate=function(a,b){var c=b;return _.isObject(LT.options.wordTranslations[a])&&_.isString(LT.options.wordTranslations[a][b])&&(c=LT.options.wordTranslations[a][b]),c},LT.utils.imagePath=function(a){return 0===a.indexOf("http")?a:LT.options.imagePath+a},LT.templates=LT.templates||{},LT.utils.getTemplate=function(b,c,d,e){var f="js/app/templates/"+b+".html",g=LT.options.templatePath+b+".html";_.isUndefined(LT.templates[f])?a.ajax({url:g,method:"GET",async:!1,contentType:"text",success:function(a){LT.templates[f]=_.template(a),c[d]=LT.templates[f],_.isFunction(e)&&e.apply(this,[a])}}):c[d]=LT.templates[f]},LT.parse=LT.parse||{},LT.parse.eData=function(a){var b={};b.categories=LT.parse.eCategories(a.sheets("Categories").all());var c=a.sheets("Bills").all();return c.length>LT.options.maxBills&&LT.log("The number of bills in your spreadsheet exceeds maxBills. Set the maxBills option to display them, but be aware that this may significantly slow down the Legislature Tracker."),b.bills=LT.parse.eBills(c.slice(0,LT.options.maxBills)),b.events=LT.parse.eEvents(a.sheets("Events").all()),_.each(_.groupBy(b.events,"bill_id"),function(a,c){_.each(b.bills,function(d,e){d.bill===c&&(b.bills[e].custom_events=a)})}),b},LT.parse.validateBillNumber=function(a){return LT.options.billNumberFormat.test(a)},LT.parse.eBills=function(a){return _.map(a,function(a){return LT.parse.translateFields(LT.options.fieldTranslations.eBills,a),a.links=LT.parse.eLinks(a.links),a.categories=a.categories?a.categories.split(","):[],a.categories=_.map(a.categories,_.trim),a.bill_primary=c,a.bill&&LT.parse.validateBillNumber(a.bill)?a.bill_primary=LT.utils.getModel("OSBillModel","bill_id",{bill_id:_.trim(a.bill)}):a.bill&&!LT.parse.validateBillNumber(a.bill)&&LT.log('Invalid primary bill number "'+a.bill+'" for row '+a.rowNumber+", see documentation."),a.bill_companion&&LT.parse.validateBillNumber(a.bill_companion)?a.bill_companion=LT.utils.getModel("OSBillModel","bill_id",{bill_id:_.trim(a.bill_companion)}):a.bill_companion&&!LT.parse.validateBillNumber(a.bill_companion)&&LT.log('Invalid companion bill number "'+a.bill_companion+'" for row '+a.rowNumber+", see documentation."),a.bill_conference&&LT.parse.validateBillNumber(a.bill_conference)?a.bill_conference=LT.utils.getModel("OSBillModel","bill_id",{bill_id:_.trim(a.bill_conference)}):a.bill_conference&&!LT.parse.validateBillNumber(a.bill_conference)&&LT.log('Invalid conference bill number "'+a.bill_conference+'" for row '+a.rowNumber+", see documentation."),a.hasBill=!0,a.bill&&a.bill_primary!==c||(a.hasBill=!1,a.bill=_.cssClass(a.title.toLowerCase())),a})},LT.parse.eCategories=function(a){return _.map(a,function(a){return LT.parse.translateFields(LT.options.fieldTranslations.eCategories,a),a.links=LT.parse.eLinks(a.links),a})},LT.parse.eEvents=function(a){return _.map(a,function(a){return LT.parse.translateFields(LT.options.fieldTranslations.eEvents,a),a.links=LT.parse.eLinks(a.links),a.date=moment(a.date),a.type=["custom"],a})},LT.parse.eLinks=function(a){var b=[];return a=_.trim(a),0===a.length?b:(a='"'===a.substring(0,1)?a.substring(1):a,a='"'===a.substring(a.length-1,a.length)?a.slice(0,-1):a,b=a.split('", "'),b=_.map(b,function(a){return{title:a.split("|")[0],url:a.split("|")[1]}}))},LT.parse.csvCategories=function(a){return a=_.trim(a),0===a.length?[]:(a='"'===a.substring(0,1)?a.substring(1):a,a='"'===a.substring(a.length-1,a.length)?a.slice(0,-1):a,a.split('", "'))},LT.parse.detectCompanionBill=function(a){var b,d;return _.isFunction(LT.options.detectCompanionBill)?(b=LT.options.detectCompanionBill(a),d=LT.parse.validateBillNumber(b)?b:c):_.isRegExp(LT.options.detectCompanionBill)&&(b=LT.options.detectCompanionBill.exec(a),d=b&&LT.parse.validateBillNumber(b[1])?b[1]:c),_.trim(d)},LT.parse.translateFields=function(a,b){return _.each(a,function(a,c){b[c]=b[a],c!==a&&delete b[a]}),b},LT.defaultOptions={sheetsWanted:["Categories","Bills","Events"],fieldTranslations:{eCategories:{id:"categoryid",short_title:"shorttitle"},eBills:{bill:"bill",bill_companion:"companionbill",bill_conference:"conferencebill",categories:"categories",title:"title",description:"description"},eEvents:{bill_id:"bill",actor:"chamber",action:"title"}},wordTranslations:{chamber:{upper:"Senate",lower:"House"},partyAbbr:{"Democratic-Farmer-Labor":"DFL",Democratic:"D",Republican:"R"}},maxBills:30,substituteMatch:/substituted/i,imagePath:"./css/images/",templatePath:"./js/app/templates/",recentChangeThreshold:7,tabletopOptions:{},scrollOffset:!1,conferenceBill:!0,recentImage:"RecentUpdatedBill.png",chamberLabel:!1,detectCompanionBill:/([A-Z]+ [1-9][0-9]*)$/,billNumberFormat:/[A-Z]+ [1-9][0-9]*/,osBillParse:!1}}(jQuery,window),function(a){LT.OSModel=Backbone.Model.extend({urlBase:function(){return"http://openstates.org/api/v1/"},urlEnd:function(){return"/?apikey="+encodeURI(LT.options.OSKey)+"&callback=?"},url:function(){return this.urlBase()+encodeURI(this.osType)+"/"+encodeURI(this.id)+this.urlEnd()},initialize:function(a,b){this.options=b,this.on("sync",function(a){a.set("fetched",!0)})}}),LT.OSStateModel=LT.OSModel.extend({url:function(){return this.urlBase()+"metadata/"+encodeURI(this.options.state)+this.urlEnd()}}),LT.OSBillModel=LT.OSModel.extend({url:function(){return _.isUndefined(this.id)?this.urlBase()+"bills/"+encodeURI(this.options.state)+"/"+encodeURI(this.options.session)+"/"+encodeURI(this.get("bill_id"))+this.urlEnd():this.urlBase()+"bills/"+this.id+this.urlEnd()},initialize:function(){LT.OSBillModel.__super__.initialize.apply(this,arguments),this.on("sync",function(){this.parseOSData()})},parseOSData:function(){var a;this.set("created_at",moment(this.get("created_at"))),this.set("updated_at",moment(this.get("updated_at"))),a=this.get("action_dates"),_.each(a,function(b,c){a[c]=b?moment(b):b}),this.set("action_dates",a),a=this.get("actions"),_.each(a,function(b,c){a[c].date=b.date?moment(b.date):b.date}),this.set("actions",a),a=this.get("votes"),_.each(a,function(b,c){a[c].date=b.date?moment(b.date):b.date}),this.set("votes",a),a=this.get("custom_events"),_.isArray(a)&&a.length>0&&this.set("actions",_.union(this.get("actions"),a)),this.set("actions",_.sortBy(this.get("actions"),function(a,b){return-1*(a.date.unix()+b)})),this.set("newest_action",this.get("actions")[0]),LT.options.osBillParse&&_.isFunction(LT.options.osBillParse)&&LT.options.osBillParse(this)},getActionDate:function(a){return this.get("action_dates")[a]?this.get("action_dates")[a]:!1},isSubstituted:function(){var a=!1;return _.isBoolean(this.get("substitued"))?a=this.get("substitued"):LT.options.substituteMatch===!1?a=!1:(a=_.find(this.get("actions"),function(a){return a.action.match(LT.options.substituteMatch)}),a=a?!0:!1,this.set("substitued",a)),a}}),LT.OSLegislatorModel=LT.OSModel.extend({osType:"legislators"}),LT.OSCommitteeModel=LT.OSModel.extend({osType:"committees"}),LT.BillModel=Backbone.Model.extend({initialize:function(a,b){this.options=b},loadOSBills:function(){var b=this,c=[];return _.each(["bill_primary","bill_companion","bill_conference"],function(a){b.get("hasBill")&&b.get(a)&&c.push(LT.utils.fetchModel(b.get(a)))}),a.when.apply(a,c)},loadOSCompanion:function(){var b,c=[];return this.get("hasBill")===!0&&!this.get("bill_companion")&&_.isObject(this.get("bill_primary"))&&_.isArray(this.get("bill_primary").get("companions"))&&_.isObject(this.get("bill_primary").get("companions")[0])&&(b=LT.parse.detectCompanionBill(this.get("bill_primary").get("companions")[0].bill_id),b&&(this.set("bill_companion",LT.utils.getModel("OSBillModel","bill_id",{bill_id:b})),c.push(LT.utils.fetchModel(this.get("bill_companion"))))),a.when.apply(a,c)},loadCategories:function(){this.get("categories")&&this.set("categories",_.map(this.get("categories"),function(a){return _.isObject(a)||(a=LT.utils.getModel("CategoryModel","id",{id:a})),a}))},lastUpdatedAt:function(){var a,b=this.get("bill_primary"),c=this.get("bill_companion"),d=this.get("bill_conference");return _.isUndefined(this.get("last_updated_at"))&&b.get("updated_at")?(a=b.get("updated_at"),c&&c.get("updated_at")&&(a=c.get("updated_at").unix()>a.unix()?c.get("updated_at"):a),d&&d.get("updated_at")&&(a=d.get("updated_at").unix()>a.unix()?d.get("updated_at"):a),this.set("last_updated_at",a)):_.isUndefined(this.get("last_updated_at"))&&!b.get("updated_at")&&LT.log("Could not fetch primary bill data from OpenStates. Check that the id "+this.get("bill_primary").get("bill_id")+" is formatted properly."),this.get("last_updated_at")},newestAction:function(){var a,b=this.get("bill_primary"),c=this.get("bill_companion"),d=this.get("bill_conference");return this.get("hasBill")&&_.isUndefined(this.get("newest_action"))&&b.get("newest_action")&&(a=b.get("newest_action"),c&&c.get("newest_action")&&(a=c.get("newest_action").date.unix()>a.date.unix()?c.get("newest_action"):a),d&&d.get("newest_action")&&(a=d.get("newest_action").date.unix()>a.date.unix()?d.get("newest_action"):a),this.set("newest_action",a)),this.get("newest_action")},parseMeta:function(){var a={upper:!1,lower:!1,conference:!1,signed:!1,last:!1},b={companion:this.get("bill_companion")?!0:!1,conference:this.get("bill_conference")?!0:!1};if(this.get("custom_events")&&this.set("custom_events",_.sortBy(this.get("custom_events"),function(a,b){return-1*(a.date.unix()+b)})),this.get("hasBill")){if(b.companion&&(this.get("bill_companion").isSubstituted()&&(b.substituted=!0),this.get("bill_primary").isSubstituted()&&(b.substituted=!0)),(!b.companion||b.substituted)&&(a.lower=this.get("bill_primary").getActionDate("passed_lower"),a.upper=this.get("bill_primary").getActionDate("passed_upper")),b.companion&&!b.substituted&&("upper"===this.get("bill_primary").get("chamber")?(a.upper=this.get("bill_primary").getActionDate("passed_upper"),a.lower=this.get("bill_companion").getActionDate("passed_lower")):(a.lower=this.get("bill_primary").getActionDate("passed_lower"),a.upper=this.get("bill_companion").getActionDate("passed_upper"))),b.conference){var c=this.get("bill_conference").getActionDate("passed_lower"),d=this.get("bill_conference").getActionDate("passed_upper");c&&d&&(a.conference=c.unix()>=d.unix()?c:d)}a.signed=b.conference?this.get("bill_conference").getActionDate("signed"):this.get("bill_primary").getActionDate("signed"),a.last=b.conference?this.get("bill_conference").getActionDate("last"):b.companion?this.get("bill_companion").getActionDate("last").unix()>=this.get("bill_primary").getActionDate("last").unix()?this.get("bill_companion").getActionDate("last"):this.get("bill_primary").getActionDate("last"):this.get("bill_primary").getActionDate("last"),this.get("description")||this.set("description",this.get("bill_primary").get("summary"))}return this.set("actions",a),this.set("bill_type",b),this}}),LT.CategoryModel=Backbone.Model.extend({initialize:function(a,b){this.options=b,this.set("bills",new LT.BillsCollection(null)),this.getBills()},getBills:function(){var a=this,b=LT.app.bills,c=this.get("id");return b.each(function(b){-1!==_.indexOf(b.get("categories"),c)&&a.get("bills").push(LT.utils.getModel("BillModel","bill",b.attributes))}),this},loadBills:function(b,c){var d=[],e=this;return this.get("bills").each(function(a){d.push(a.loadOSBills())}),a.when.apply(a,d).done(function(){var d=[];e.get("bills").each(function(a){d.push(a.loadOSCompanion())}),a.when.apply(a,d).done(function(){e.get("bills").each(function(a){a.parseMeta()}),b()}).fail(c)}).fail(c),this}})}(jQuery,window),function(){LT.CategoriesCollection=Backbone.Collection.extend({model:LT.CategoryModel,comparator:function(a){return-1!==a.get("title").toLowerCase().indexOf("recent")?"zzzzz":a.get("title")}}),LT.BillsCollection=Backbone.Collection.extend({model:LT.BillModel,comparator:function(a){var b=a.newestAction()?-1*a.newestAction().date.unix():a.get("title");return b}}),LT.OSBillsCollection=Backbone.Collection.extend({model:LT.OSBillModel,comparator:function(a){var b=a.get("newest_action");return b&&(b=-1*b.date.unix()),b}})}(jQuery,window),function(a,b){LT.MainApplicationView=Backbone.View.extend({initialize:function(){this.$el.addClass("ls"),this.templates=this.templates||{},LT.utils.getTemplate("template-loading",this.templates,"loading"),LT.utils.getTemplate("template-error",this.templates,"error"),LT.utils.getTemplate("template-ebill",this.templates,"ebill"),LT.utils.getTemplate("template-osbill",this.templates,"osbill"),LT.utils.getTemplate("template-category",this.templates,"category"),LT.utils.getTemplate("template-categories",this.templates,"categories"),LT.utils.getTemplate("template-header",this.templates,"header"),_.bindAll(this)},events:{"click .bill-expand":"expandBill","click .expand-other-bills":"expandOtherBills"},loading:function(){return _.isNumber(LT.options.scrollOffset)&&(this.initialLoad===!0?this.resetScrollView():this.initialLoad=_.isUndefined(this.initialLoad)?!1:!0),this.$el.html(this.templates.loading({})),this},error:function(a){return this.$el.html(this.templates.error({error:a})),this},renderCategories:function(){this.$el.html(this.templates.categories({categories:LT.app.categories.toJSON(),options:LT.options}))},renderCategory:function(a){_.isObject(a)||(a=LT.app.categories.get(a)),a.get("bills").sort(),this.$el.html(this.templates.category({category:a.toJSON(),templates:this.templates,header:this.renderHeader()})),this.getLegislators().navigationGlue()},renderEBill:function(a){_.isObject(a)||(a=this.router.bills.get(a)),a.newestAction(),this.$el.html(this.templates.ebill({bill:a.toJSON(),expandable:!1,templates:this.templates,header:this.renderHeader()})),this.getLegislators().addTooltips().checkOverflows().navigationGlue()},renderOSBill:function(a){this.$el.html(this.templates.osbill({bill:a.toJSON(),detailed:!0,templates:this.templates,header:this.renderHeader()})),this.getLegislators().addTooltips().checkOverflows().navigationGlue()},renderHeader:function(){return this.templates.header({categories:LT.app.categories.toJSON()})},expandBill:function(b){b.preventDefault();var c=a(b.target),d=["More detail","Less detail"],e=c.text();return c.text(e===d[0]?d[1]:d[0]),c.parent().toggleClass("expanded").find(".bill-bottom").slideToggle(),this.checkOverflows(),this},expandOtherBills:function(b){b.preventDefault();var c=a(b.target),d=["Show other bills","Hide other bills"],e=c.text();return c.text(e===d[0]?d[1]:d[0]),c.parent().find(".has-conference-bill").toggleClass("showing").slideToggle(),this.checkOverflows(),this},getLegislators:function(){return this.$el.find(".sponsor:not(.found)").each(function(){var b=a(this),c=b.data();if(c.id=c.legId,c.id){var d=LT.utils.getModel("OSLegislatorModel","id",c);a.when(LT.utils.fetchModel(d)).then(function(){new LT.LegislatorView({el:b,model:d}).render()})}}),this},addTooltips:function(){return this.$el.find(".bill-progress .bill-progress-section.completed").qtip({style:{classes:"qtip-shadow qtip-light"},position:{my:"bottom center",at:"top center"}}),this},checkOverflows:function(){return this.$el.find(".actions-inner, .co-sponsors-inner").each(function(){a(this).hasScrollBar()&&a(this).addClass("overflowed")}),this},resetScrollView:function(){return a("html, body").animate({scrollTop:this.$el.offset().top-LT.options.scrollOffset},1e3),this},navigationGlue:function(){var c=this.$el.offset().top,d=a(".ls-header");return a(".ls-header-container").height(d.outerHeight()),a(b).scroll(function(){var b=a(this);b.scrollTop()>c&&!d.hasClass("glued")?d.addClass("glued"):b.scrollTop()<=c&&d.hasClass("glued")&&d.removeClass("glued")}),this}}),LT.LegislatorView=Backbone.View.extend({model:LT.OSLegislatorModel,initialize:function(){this.templates=this.templates||{},LT.utils.getTemplate("template-legislator",this.templates,"legislator"),_.bindAll(this)},render:function(){return this.$el.addClass("found").html(this.templates.legislator(this.model.toJSON())),this}})}(jQuery,window),function(a){LT.Application=Backbone.Router.extend({routes:{categories:"routeCategories","category/recent":"routeRecentCategory","category/:category":"routeCategory","bill/:bill":"routeEBill","bill-detail/:bill":"routeOSBill","*defaultR":"routeDefault"},initialize:function(a){LT.options=_.extend(LT.defaultOptions,a),LT.app=this,_.bindAll(this),this.mainView=new LT.MainApplicationView(LT.options),this.mainView.router=this,this.mainView.loading(),this.tabletop=Tabletop.init(_.extend(LT.options.tabletopOptions,{key:LT.options.eKey,callback:this.loadEBills,callbackContext:this,wanted:LT.options.sheetsWanted}))},loadEBills:function(b,c){var d=this,e=LT.parse.eData(c);this.categories=new LT.CategoriesCollection(null),this.bills=new LT.BillsCollection(null),_.each(e.bills,function(a){d.bills.add(LT.utils.getModel("BillModel","bill",a))}),_.each(e.categories,function(a){d.categories.add(LT.utils.getModel("CategoryModel","id",a))}),this.bills.each(function(a){a.loadCategories()}),LT.options.aggregateURL?a.jsonp({url:LT.options.aggregateURL,success:this.loadAggregateCounts}):this.start()},loadAggregateCounts:function(a){var b=this;_.each(a,function(a){"total-bills"===a.stat&&(b.totalBills=parseInt(a.value,10)),"total-bills-passed"===a.stat&&(b.totalBillsPassed=parseInt(a.value,10)),"total-bills-signed"===a.stat&&(b.totalBillsSigned=parseInt(a.value,10))}),this.start()},start:function(){Backbone.history.start()},routeDefault:function(){this.navigate("/categories",{trigger:!0,replace:!0}),this.mainView.render()},routeCategories:function(){var a=this;this.mainView.loading(),this.getOSBasicBills(function(){a.makeRecentCategory(),a.mainView.renderCategories()},this.error)},routeCategory:function(a){var b=this;a=decodeURI(a),a=this.categories.get(a),this.mainView.loading(),a.loadBills(function(){b.mainView.renderCategory(a)},b.error)},routeRecentCategory:function(){var a=this;this.mainView.loading(),this.getOSBasicBills(function(){a.makeRecentCategory();var b=a.categories.get("recent");b.loadBills(function(){a.mainView.renderCategory(b)},a.error)},this.error)},routeEBill:function(a){var b=this,c=decodeURI(a);return(a=this.bills.where({bill:c})[0])?(this.mainView.loading(),a.loadOSBills().done(function(){a.loadOSCompanion().done(function(){a.parseMeta(),b.mainView.renderEBill(a)})}).fail(b.error),void 0):(this.navigate("/bill-detail/"+encodeURI(c),{trigger:!0,replace:!0}),void 0)},routeOSBill:function(b){var c=this;b=decodeURI(b),b=LT.utils.getModel("OSBillModel","bill_id",{bill_id:b}),this.mainView.loading(),a.when.apply(a,[LT.utils.fetchModel(b)]).done(function(){c.mainView.renderOSBill(b)}).fail(c.error)},makeRecentCategory:function(){if(!this.madeRecentCategory){var a={id:"recent",title:"Recent Actions",description:"The following bills have been updated in the past "+LT.options.recentChangeThreshold+" days.",image:LT.options.recentImage};this.bills.each(function(b){var c=b.get("categories"),d=b.get("hasBill");d===!0&&Math.abs(parseInt(b.lastUpdatedAt().diff(moment(),"days"),10))<LT.options.recentChangeThreshold&&(c.push(a.id),b.set("categories",c))}),this.categories.add(LT.utils.getModel("CategoryModel","id",a)),this.bills.each(function(a){a.loadCategories()}),this.madeRecentCategory=!0}},getOSBasicBills:function(b){var c=this,d=[];if(this.fetchedCategories)b.call(c);else{this.bills.each(function(a){_.each(["bill_primary","bill_companion","bill_conference"],function(b){a.get(b)&&d.push(a.get(b).get("bill_id"))})});var e="http://openstates.org/api/v1/bills/?state="+LT.options.state+"&search_window=session:"+LT.options.session+"&bill_id__in="+encodeURI(d.join("|"))+"&apikey="+LT.options.OSKey+"&callback=?";a.jsonp({url:e,success:function(a){c.fetchedCategories=!0,_.each(a,function(a){a.created_at=moment(a.created_at),a.updated_at=moment(a.updated_at),LT.utils.getModel("OSBillModel","bill_id",a).set(a)}),b.call(c)},error:this.error})}},error:function(a){this.mainView.error(a)}})}(jQuery,window);